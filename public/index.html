<!DOCTYPE html>
<html>

<style type="text/css">
html,
body {
    margin: 0;
    overflow: hidden;
}
canvas {

	margin-left: 2%;	
	margin-right: 8%;
	margin-top: 2%;
	margin-bottom : 8%;
	border-style: solid;
	border-width: 4px;

    width: 1272px;
	height: 632px;
}
</style>

<head>

<script type="text/javascript">
	var ws = new WebSocket('wss://localhost:3250');
	
	/* Problêmes si nom redondant à gérer
	var person = prompt("Please enter your name", "Snakey Snake");
	while(person == null)
	{
		person = prompt("Please enter your name", "Snakey Snake");
	}
	*/
	
</script>
<!-- Load the Paper.js library -->
<script type="text/javascript" src="js/paper.js"></script>
<!-- Define inlined PaperScript associate it with myCanvas -->
<script type="text/paperscript" canvas="myCanvas">
	
	// Variables du jeu
	var speed = 200;
	var colors = ['#ff0000','#ffffff','#00ffff','#0000ff','#00ff00''#ffff00''#ff00ff'];

	// Tableaux de communication client/serveur
	var onScreenSnakes = [];
	var allSnakes = [];
	var localData;
	var id;
	
	var circle = new Path.Circle({
		center: headCenter,
		radius: 6,
		fillColor: startColor
	});
	
	var color = Math.round(Math.random() * 8)
	var circle = [];
	circle[0] = 100+Math.random()*1072;
	circle[1] = 100+Math.random()*432;
	circle[2] = color;
	console.log(color);
	var x = circle.position.x;
	var y = circle.position.y;
	
	function onMouseUp(event) {
		// Génération d'un vecteur entre la pos. actuelle et la pos. désirée
		vector = event.point - circle.position;
		vector.length = speed;
		
		x = circle.position.x;
		y = circle.position.y;
		
		// Envoi de la tête et du vecteur au serveur pour transmission à autres clients
		localData=[x,y,color];
		ws.send(JSON.stringify(localData));
	}
	
	// Ici, on reçoit le broadcast du serveur
	ws.onmessage = function(msg) {
			
			// On veut update le déplacement de tous les snakes
			allSnakes = JSON.parse(msg.data);
			console.log("Message reçu");
			for(var i = 0;i < allSnakes.length;i++)
			{
				var randomColor = new Color(i*50,100,50);
				var headPoint = new Point(allSnakes[i][0],allSnakes[i][1]);
				var head = new Path.Circle({
				center: headPoint,
				radius: 6,
				fillColor: randomColor
				});
				
			}
	}
</script>
<body>
 <canvas id="myCanvas" resize></canvas>
</body>
</head>
</html>